<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science Bee Practice</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #e0f7fa, #ffffff);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .question-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
            max-width: 800px;
            width: 100%;
            transition: transform 0.3s ease;
        }
        .question-container:hover {
            transform: translateY(-2px);
        }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }
        .question-id {
            font-weight: 600;
            color: #00796b;
            font-size: 1.1em;
        }
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .play-button, .pause-button, .stop-button {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #00796b;
            transition: color 0.2s ease;
        }
        .play-button:hover, .pause-button:hover, .stop-button:hover {
            color: #004d40;
        }
        .voice-select {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #00796b;
            background: #f0f9f9;
            color: #333;
            font-size: 0.9em;
            max-width: 200px;
        }
        .button-row {
            display: flex;
            justify-content: flex-start;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            gap: 10px;
            align-items: center;
        }
        .end-session-wrapper {
            margin-left: auto;
        }
        button {
            @apply bg-teal-600 text-white px-5 py-2.5 rounded-full font-semibold text-sm transition-all duration-200 hover:bg-teal-700 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-50;
            min-width: 120px;
        }
        button:disabled {
            @apply bg-gray-400 cursor-not-allowed hover:bg-gray-400 hover:shadow-none;
        }
        button:active {
            transform: scale(0.98);
        }
        .result-section {
            margin: 15px 0;
            padding: 15px;
            background: #f0f9f9;
            border-radius: 10px;
            border-left: 4px solid #00796b;
            display: none;
        }
        .result-section label {
            margin-right: 15px;
            font-size: 0.95em;
        }
        .summary-section {
            display: none;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
            text-align: center;
        }
        .summary-section p {
            margin: 5px 0;
            font-size: 1.1em;
            color: #00796b;
        }
        progress {
            width: 100%;
            max-width: 800px;
            height: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            background: #e0e0e0;
        }
        progress::-webkit-progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
        }
        progress::-webkit-progress-value {
            background: #00796b;
            border-radius: 10px;
        }
        @media (max-width: 600px) {
            .question-container { padding: 15px; }
            button { padding: 8px 16px; font-size: 0.9em; min-width: 100px; }
            .button-row { flex-direction: column; gap: 8px; }
            .button-row button { width: 100%; }
            .end-session-wrapper { margin-left: 0; order: 1; }
            .question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .voice-select {
                width: 100%;
                max-width: none;
            }
            .audio-controls {
                flex-wrap: wrap;
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="question-container" id="question-container"></div>
    <progress id="progress" value="0" max="86"></progress>
    <div class="button-row">
        <button id="show-answer">Show Answer</button>
        <div class="end-session-wrapper">
            <button id="end-session" disabled>End Session</button>
        </div>
    </div>
    <div id="result-section" class="result-section">
        <p>Mark the result:</p>
        <label><input type="radio" name="result" value="correct"> Correct</label>
        <label><input type="radio" name="result" value="wrong"> Wrong</label>
        <label><input type="radio" name="result" value="skipped"> Skipped</label>
        <p id="result-feedback" style="color: #00796b; font-weight: bold;"></p>
    </div>
    <div class="button-row" id="action-buttons" style="display: none;">
        <button id="next-question" style="display: none;">Next Question</button>
        <div class="end-session-wrapper">
            <button id="end-session-action" disabled>End Session</button>
        </div>
    </div>
    <div class="summary-section" id="summary-section"></div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            let currentIndex = -1;
            let currentUtterance = null;
            let isPaused = false;
            let selectedVoiceIndex = -1;
            let voices = [];
            const questions = [
    { number: 1, topic: "Physics", text: "Because it lacks a differentiated core, this phenomenon on the moon is concentrated in the crust. Rocks that naturally exhibit this phenomenon are called lodestones. The geodynamo theory proposes that this phenomenon in the Earth is created by the liquid outer core, causing compasses to point north. For the point, name this phenomenon which attracts metals like nickel and iron.", answer: "magnetism (accept word forms like magnetic or magnets)" },
    { number: 2, topic: "Astronomy", text: "This planet's gravity induces tidal forces that cause volcanism on some of its moons. This planet is orbited by the largest moon in the Solar System, which is larger than the planet Mercury. This planet's moons include Callisto, Io [[EYE-oh]], Ganymede, and Europa. This planet is home to a massive anti-cyclone storm called the Great Red Spot. For the point, name this largest planet in the Solar System.", answer: "Jupiter" },
    { number: 3, topic: "History of Science", text: "Two scientists with this surname learned that compressing quartz leads to an electric potential, discovering piezoelectricity. Work from those studies was used by a physicist with this surname to study the properties of uranium in pitchblende. Henri Becquerel and two people with this surname shared the 1903 Nobel Prize in Physics. For the point, give the last name of a physicist who won two Nobel Prizes for researching radioactivity and discovering Radium and Polonium.", answer: "Curie (accept Marie Curie, Pierre Curie, Jacques Curie)" },
    { number: 4, topic: "Chemistry", text: "When these elements have their electron configuration written out, they are denoted with their name in brackets. These elements tend to have relatively small atomic radii due to having high effective nuclear charges. These elements are mostly non-reactive due to possessing full valence shells of electrons. For the point, name this group of elements including neon and helium which is located at the rightmost portion of the periodic table.", answer: "noble gases (or group 18; or group 8A)" },
    { number: 5, topic: "Biology", text: "The centimorgan unit maps loci on these structures, consisting of p and q arms. Crossing over occurs between homologous pairs of these structures. A karyotype can show the diploid number of these, 46 in humans, as well as the presence of three of number 21 in a Down syndrome patient. Lining up along the equator during the metaphase of mitosis, for the point, what are these DNA structures?", answer: "chromosomes" },
    { number: 6, topic: "Earth Science", text: "This structure is above the Moho discontinuity, which separates it from the layer below. The outer part of the lithosphere is made up of this layer, which comes in oceanic and continental forms. This structure is generated at mid-ocean ridges and destroyed at subduction zones and is primarily composed of silica and oxygen. Resting atop the mantle, for the point, name this outermost layer of the Earth’s surface.", answer: "crust" },
    { number: 7, topic: "Biology", text: "The earliest variety of this technology involved injecting mice or rabbits with the subject's bodily fluids. Another early example of this technology was based on observing whether Xenopus [[ZEN-uh-puhs]] frogs ovulated after receiving an injection. This technology works by measuring human chorionic gonadotropin in a urine sample. For the point, name these devices which indicate whether a woman is carrying a fetus.", answer: "pregnancy tests" },
    { number: 8, topic: "Chemistry", text: "When this element is present, a three-to-one ratio is displayed in mass spectrometry. Aqua regia includes nitric acid and an acid with this anion [[AN-eye-on]]. Stomach acid contains the acid of this element, two atoms of which are found in mustard gas. The diatomic form of this element is a green gas while another form is used to disinfect swimming pools. For the point, name this halogen with chemical symbol Cl [[SEE-ELL]].", answer: "chlorine (accept Cl before mentioned)" },
    { number: 9, topic: "Computer Science", text: "A company that runs one of these software systems named Ecosia claims to be environmentally friendly and plants trees with its profits. Information will no longer be displayed by these programs following de-listing. These programs identify potential matches for queries using web crawling. For the point, name these web programs used to find information on the internet, the most popular of which are Bing and Google.", answer: "search engines" },
    { number: 10, topic: "Math", text: "In polar coordinates, the equation \"r equals the constant A\" produces one of these shapes. The Cartesian product of two of these shapes gives a torus. This conic section defines an eccentricity of zero, and a square cannot be constructed with the same area as this shape with only a compass and straightedge. Pi times the radius squared gives the area of, for the point, what 2D shape consisting of all points equidistant from a fixed center?", answer: "circle" },
    { number: 11, topic: "Chemistry", text: "The finding that this particle's constituents contribute almost no spin has led to its namesake \"spin crisis.\" Some Grand Unified Theories hypothesize that this particle can decay into a positron and a neutral pion. Cosmic rays consist mostly of these particles, which are made of two up quarks and one down quark. For the point, name this subatomic particle with a positive charge.", answer: "protons" },
    { number: 12, topic: "Biology", text: "Drugs that treat a disease caused by this virus include enfuvirtide [[en-FYOO-veer-tide]] and lamivudine [[lah-MIHV-yoo-deen]]. This virus of the Lentivirus genus may present with Kaposi's sarcoma. X4R5 is a subtype of this virus which can use both CXCR4 and CCR5 receptors to enter the cell. The drug zidovudine [[zai-DOH-vyoo-deen]], or AZT, reduces activity of the reverse transcriptase of this virus which infects helper T-cells. For the point, name this retrovirus which causes AIDS.", answer: "HIV (or human immunodeficiency virus)" },
    { number: 13, topic: "Astronomy", text: "A poem written after one of these events states \"one thing at least is certain, light has weight.\" That poem was written by Arthur Eddington, who tested the theory of general relativity during one of these events. Jules Janssen and Norman Lockyer discovered helium in a spectral line during one of these events. For the point, “solar” and “lunar” are types of what celestial events in which light from the sun is blocked?", answer: "eclipses" },
    { number: 14, topic: "Chemistry", text: "This element is extracted from ores by coordination with cyanide. This element scattered alpha particles in an experiment sometimes named for Geiger and Marsden that discovered the atomic nucleus. This most malleable metal can be dissolved by aqua regia. Iron pyrite resembles this element, leading it to be nicknamed “fool’s [this element].” For the point, name this precious metal with chemical symbol Au.", answer: "gold (accept Au before mentioned)" },
    { number: 15, topic: "Biology", text: "An assumption of this theory is that differential fitness is heritable, and the main proponent of this theory was influenced by Malthus. Analogous structures are created in the convergent form of this process, and genetic variation is a pre-requisite for this process to occur. Theorized to occur via natural selection, for the point, what is this theory about inherited changes in populations over time which was put forward by Charles Darwin?", answer: "theory of evolution" },
    { number: 16, topic: "Biology", text: "Hyperhidrosis of this organ can be treated with the microwave MiraDry technique. An early symptom of leprosy is loss of pain sensation in this organ. The urticating hairs of some caterpillars irritate the eyes as well as this organ. Scabies mites attack the epidermal layers of this organ in which bacterial infection of sebaceous glands causes acne. The pigment melanin gives color to, for the point, what exterior human organ which produces sweat?", answer: "skin (accept epidermis before \"epidermal\" is mentioned)" },
    { number: 17, topic: "Earth Science", text: "When these objects form on top of each other, they are known as \"pileus.\" The term \"nimbus\" refers to examples of these objects associated with storms. At high altitudes, these objects are composed of ice crystals and are called \"cirrus.\" Lower level varieties of these objects include stratus and cumulus. For the point, name these large masses of water vapor from which rain is released.", answer: "clouds" },
    { number: 18, topic: "Biology", text: "Types of this molecule called “si” and “mi” are used in “interference” experiments. A type of this molecule can be “charged” with the enzyme aaRS and has a “cloverleaf” shape. The secondary structure of this molecule can exhibit “wobble,\" and the “messenger” type of this molecule contains codons. This uracil-containing molecule is translated into protein by ribosomes. For the point, name this single-stranded nucleic acid contrasted with DNA.", answer: "RNA (or Ribonucleic acid)" },
    { number: 19, topic: "Earth Science", text: "Extremely viscous types of this substance can form coulées. Common forms of this substance include ʻaʻā [[AH-AH]] and pahoehoe [[pah-HOE-ay-HOE-ay]]. When released underwater, this substance can form its \"pillow\" variety. Extrusive igneous rocks such as pumice are formed by the cooling of this substance. Prior to being ejected, this substance is known as magma. For the point, name this molten rock which is ejected by volcanoes.", answer: "lava (do not accept or prompt on \"magma\")" },
    { number: 20, topic: "Physics", text: "A semi-empirical formula for this quantity named for Bethe [[BEH-tuh]] and Weizsäcker [[VAIT-seh-kuh]] can also be used to calculate nuclear binding energy using its namesake \"defect.\" The Higgs boson gives particles this property, which also equals energy divided by the speed of light squared according to a formula proposed by Albert Einstein. For the point, name this quantity symbolized \"m\" and measured in kilograms.", answer: "mass (accept m before mentioned)" },
    { number: 21, topic: "Earth Science", text: "When mixed with asphalt, this material can be made into \"blacktop.\" In large buildings, this material can be reinforced with steel rebar, and unlike mortar, this material is primarily used as a building material itself and not as a binding agent. For the point, name this material composed primarily of rock pieces bound together by cement, which is used to build roads and sidewalks.", answer: "concrete (prompt on \"cement\" until mentioned)" },
    { number: 22, topic: "Chemistry", text: "Some compounds composed of these molecules have a lattice energy that can be measured via applications of Hess’s law, and they are held together by electrostatic attractions. A covalent bond unites atoms in the polyatomic type of these molecules. For the point, name these charged molecules that can be either cations [[CAT-\"eye\"-ons]] or anions.", answer: "Ions (accept Ionic Compounds; accept Cation or Anions before mentioned)" },
    { number: 23, topic: "Physics", text: "This type of electromagnetic radiation is utilized in Mossbauer spectroscopy, and bursts of this type of radiation last briefly before emitting radiation of a longer wavelength, such as X-rays. For the point, name this type of radiation that has the shortest wavelength on the electromagnetic spectrum and can be produced by nuclear fission.", answer: "Gamma Rays (accept Gamma Ray Burst; accept Terrestrial Gamma Ray Flash)" },
    { number: 24, topic: "Biology", text: "The sarcoplasmic type of this organelle releases calcium ions during muscle contraction. It’s not the Golgi apparatus, but flattened sacs called cisternae are found in this organelle. This organelle folds proteins, and its types are distinguished by the presence or absence of studded ribosomes. For the point, name this organelle that comes in smooth and rough types.", answer: "Endoplasmic Reticulum (or ER; accept Smooth Endoplasmic Reticulum or ER; accept Rough Endoplasmic Reticulum or ER; prompt on “Reticulum” or “Endoplasmic”)" },
    { number: 25, topic: "Chemistry", text: "This molecule is phosphorylated by hexokinase in the first step of its conversion to pyruvate. Formation of this molecule requires six carbon dioxide molecules and six water molecules, and cellulose is composed of units of this most abundant monosaccharide. For the point, name this six-carbon molecule, the main component of blood sugar.", answer: "Glucose" },
    { number: 26, topic: "Physics", text: "The namesake load of these devices can be found by dividing charge by voltage. These devices can be created by inserting a resistive dielectric between two parallel plates, and these devices' namesake quantity is measured in farads. For the point, name these circuit components that passively hold an electric charge.", answer: "Capacitors" },
    { number: 27, topic: "Earth Science", text: "Flank vents are peripherals to this type of landform that may form from a cinder cone. Calderas are formed on these landforms as the result of the collapse of a magma chamber. For the point, name these landforms that are prone to eruption and include examples such as Mt. Saint Helens.", answer: "Volcano (accept Caldera before mentioned; accept specific types of Volcano)" },
    { number: 28, topic: "Biology", text: "This organ is located at the end of the cecum, which is located at the beginning of the large intestine. This hollow tube is closed on one end and is believed to be vestigial in humans. For the point, name this organ which cab be easily removed to relieve its namesake inflammation due to having no currently known life-sustaining function.", answer: "Appendix" },
    { number: 29, topic: "Earth Science", text: "Some of the largest types of features made from this natural material include Christmas Island. Islands formed from this material comprise the countries of Tuvalu and Kiribati [[KEER-uh-bahs]], and this material also comprises the world's largest structure made by living organisms. For the point, name this material that forms the Great Barrier Reef.", answer: "Coral (accept Coral Atolls; prompt on \"Great Barrier Reef\" until mentioned)" },
    { number: 30, topic: "Astronomy", text: "The crusts of these objects are subject to frame dragging and strong magnetic dipole rotation that can cause starquakes. When these objects possess extreme magnetic fields they are called magnetars, and when these objects emit regular bursts of radiation they are known as pulsars. For the point, name these extremely dense stars composed of a namesake neutral particle.", answer: "Neutron Stars (accept Pulsars before mentioned)" },
    { number: 31, topic: "Math", text: "This number that was estimated in the Buffon's needle problem appears as one of the two exponents in Euler's [[OY-luhrs]] identity. 180 degrees equals this number of radians, and twice the product of the radius and this number helps compute the circumference of a circle. For the point, give this number approximately equal to 22 over 7, or 3.14.", answer: "Pi (accept 3.14 before mentioned; accept Archimedes' Constant)" },
    { number: 32, topic: "Earth Science", text: "Hygrometers are used to measure this property which can be reduced or maintained using air-conditioner devices. High levels of this property reduce the rate of heat evaporation from skin surfaces. For the point, name this property found in high levels in tropical countries that measures the concentration of water vapor in the air.", answer: "Humidity" },
    { number: 33, topic: "History of Science", text: "One type of military technology named for this civilization was introduced in a \"Double piston pump\" variety. That early flamethrower was a type of \"Fire\" named for this civilization that invented the clepsydra, a type of automated water clock. For the point, identify this civilization that made advancements in medicine thanks to Hipppocrates.", answer: "Greece (accept Greek or Greeks; accept Hellenic Republic; accept Elliniki Dimokratia; accept Ellas or Ellada)" },
    { number: 34, topic: "Earth Science", text: "Most of these objects are classified as chondrites, and these objects concentrate in the Transantarctic Mountains after striking glaciers. Particularly bright examples of these objects are known as bolides, but they get another name after striking the ground. Found inside impact craters, these are, for the point, what fallen space rocks?", answer: "Meteorites (prompt on “Asteroids;” prompt on \"Meteoroids\")" },
    { number: 35, topic: "Chemistry", text: "This element forms a structural motif in DNA domains known as its namesake “finger.\" This element is commonly used to galvanize iron and steel against corrosion in heavy industry. This element’s alloy with copper is brass, and it is the main component of pennies. Ointments and sunscreen commonly use an oxide of, for the point, what metal with symbol Zn?", answer: "Zinc (accept Zn before mentioned; accept Zinc Finger)" },
    { number: 36, topic: "Chemistry", text: "A single bond between two atoms of this element is present in molecules used to catalyze radical reactions. Another molecule with three atoms of this element is present in the stratosphere to absorb UV light. In respiration, a diatomic molecule of this element is exchanged for carbon dioxide. For the point, name this element with atomic number 8 and symbol O.", answer: "Oxygen (prompt on \"Peroxide;\" prompt on \"Ozone\")" },
    { number: 37, topic: "Astronomy", text: "It’s not the Earth, but scientists estimate this body formed 4.6 billion years ago from the gravitational collapse of matter. Copernicus first advanced the theory that the planets don’t orbit Earth, but rather this object, the nearest star to Earth. For the point, name this massive body at the center of the solar system.", answer: "Sun (accept Sol)" }
];

            let shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);
            let answersShown = new Set();
            const topicStats = {};
            questions.forEach(q => {
                topicStats[q.topic] = { presented: 0, correct: 0, wrong: 0, skipped: 0 };
            });
            const progressBar = document.getElementById("progress");
            progressBar.max = shuffledQuestions.length;

            // Updated set boundaries for 85 questions: Set 1 (1-31: first PDF), Set 2 (32-58: second PDF), Set 3 (59-85: third PDF)
            const setBoundaries = [0, 37];
            
            function getSetNumber(index) {
                for (let i = 0; i < setBoundaries.length - 1; i++) {
                    if (index >= setBoundaries[i] && index < setBoundaries[i + 1]) {
                        return i + 1;
                    }
                }
                return 1; // Fallback
            }

            // Voice selection setup
            function populateVoiceDropdown() {
                voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : [];
                const voiceSelect = document.getElementById('voice-select');
                if (!voiceSelect) return;
                voiceSelect.innerHTML = '<option value="-1">Select Voice</option>';
                if (voices.length === 0) {
                    voiceSelect.innerHTML = '<option value="-1">No voices available</option>';
                } else {
                    voices.forEach((voice, index) => {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        voiceSelect.appendChild(option);
                    });
                    voiceSelect.value = selectedVoiceIndex >= 0 && selectedVoiceIndex < voices.length ? selectedVoiceIndex : -1;
                }
            }
            if (window.speechSynthesis) {
                window.speechSynthesis.onvoiceschanged = populateVoiceDropdown;
                populateVoiceDropdown();
            }

            function displayQuestion() {
                if (currentIndex >= 0) {
                    document.getElementById("show-answer").style.display = "inline-block";
                }
                if (currentIndex >= shuffledQuestions.length - 1) {
                    document.getElementById("next-question").style.display = "none";
                    return;
                }
                currentIndex++;
                const question = shuffledQuestions[currentIndex];
                const setNumber = getSetNumber(currentIndex);
                const questionId = `Set ${setNumber}, Question ${question.number}`;
                // Reset speech state
                if (currentUtterance && window.speechSynthesis) {
                    window.speechSynthesis.cancel();
                    currentUtterance = null;
                    isPaused = false;
                }
                document.getElementById("question-container").innerHTML = `
                    <div class="question-header">
                        <div class="question-id">${questionId}</div>
                        <div class="audio-controls">
                            <button class="play-button" id="play-question" title="Play Question Audio">▶️</button>
                            <button class="pause-button" id="pause-question" title="Pause Audio">⏸️</button>
                            <button class="stop-button" id="stop-question" title="Stop Audio">⏹️</button>
                            <select class="voice-select" id="voice-select"></select>
                        </div>
                    </div>
                    <p class="text-lg">${question.text}</p>
                `;
                // Re-populate voice dropdown
                populateVoiceDropdown();
                document.getElementById("show-answer").style.display = "inline-block";
                document.getElementById("next-question").style.display = "none";
                document.getElementById("end-session-action").disabled = true;
                topicStats[question.topic].presented++;
                progressBar.value = currentIndex + 1;

                // Add event listeners for audio controls
                const playButton = document.getElementById("play-question");
                const pauseButton = document.getElementById("pause-question");
                const stopButton = document.getElementById("stop-question");
                const voiceSelect = document.getElementById("voice-select");

                if (playButton && window.speechSynthesis) {
                    playButton.addEventListener("click", () => {
                        if (currentUtterance && window.speechSynthesis.speaking && !isPaused) {
                            window.speechSynthesis.cancel();
                        }
                        currentUtterance = new SpeechSynthesisUtterance(question.text);
                        currentUtterance.lang = 'en-US';
                        currentUtterance.rate = 0.9;
                        if (voices.length > 0 && selectedVoiceIndex >= 0 && selectedVoiceIndex < voices.length) {
                            currentUtterance.voice = voices[selectedVoiceIndex];
                        }
                        window.speechSynthesis.speak(currentUtterance);
                        isPaused = false;
                        pauseButton.title = "Pause Audio";
                        pauseButton.innerHTML = "⏸️";
                    });
                }

                if (pauseButton && window.speechSynthesis) {
                    pauseButton.addEventListener("click", () => {
                        if (!currentUtterance) return;
                        if (isPaused) {
                            window.speechSynthesis.resume();
                            isPaused = false;
                            pauseButton.title = "Pause Audio";
                            pauseButton.innerHTML = "⏸️";
                        } else if (window.speechSynthesis.speaking) {
                            window.speechSynthesis.pause();
                            isPaused = true;
                            pauseButton.title = "Resume Audio";
                            pauseButton.innerHTML = "▶️";
                        }
                    });
                }

                if (stopButton && window.speechSynthesis) {
                    stopButton.addEventListener("click", () => {
                        if (currentUtterance) {
                            window.speechSynthesis.cancel();
                            currentUtterance = null;
                            isPaused = false;
                            pauseButton.title = "Pause Audio";
                            pauseButton.innerHTML = "⏸️";
                        }
                    });
                }

                if (voiceSelect) {
                    voiceSelect.addEventListener("change", (e) => {
                        selectedVoiceIndex = parseInt(e.target.value);
                    });
                }
            }

            function showAnswer() {
                console.log("Show Answer clicked");
                const container = document.getElementById("question-container");
                if (!container) {
                    console.error("Question container not found");
                    return;
                }
                const question = shuffledQuestions[currentIndex];
                container.innerHTML += `<p class="text-green-700 font-bold mt-2">Answer: ${question.answer}</p>`;
                document.getElementById("show-answer").style.display = "none";
                document.getElementById("result-section").style.display = "block";
                // Stop speech when showing answer
                if (currentUtterance && window.speechSynthesis) {
                    window.speechSynthesis.cancel();
                    currentUtterance = null;
                    isPaused = false;
                    const pauseButton = document.getElementById("pause-question");
                    if (pauseButton) {
                        pauseButton.title = "Pause Audio";
                        pauseButton.innerHTML = "⏸️";
                    }
                }
            }


        function updateResult() {
            const result = document.querySelector('input[name="result"]:checked');
            if (!result) {
                document.getElementById("next-question").style.display = "none";
                document.getElementById("end-session-action").disabled = true;
                return;
            }
            const resultValue = result.value;
            const question = shuffledQuestions[currentIndex];
            if (resultValue === "correct") {
                topicStats[question.topic].correct++;
                document.getElementById("result-feedback").textContent = "Marked as Correct!";
            } else if (resultValue === "wrong") {
                topicStats[question.topic].wrong++;
                document.getElementById("result-feedback").textContent = "Marked as Wrong!";
            } else if (resultValue === "skipped") {
                topicStats[question.topic].skipped++;
                document.getElementById("result-feedback").textContent = "Marked as Skipped!";
            }
            document.getElementById("action-buttons").style.display = "flex";
            document.getElementById("next-question").style.display = "inline-block";
            document.getElementById("end-session-action").disabled = false;
            document.getElementById("end-session").style.display = "none"; // Hide initial End Session
        }

        function showSummary() {
            let summaryContent = `<h2 class="text-xl font-bold text-teal-700">Session Summary</h2>`;
            for (let topic in topicStats) {
                summaryContent += `<p>Topic: ${topic}</p><p>Presented: ${topicStats[topic].presented}</p><p>Correct: ${topicStats[topic].correct}</p><p>Wrong: ${topicStats[topic].wrong}</p><p>Skipped: ${topicStats[topic].skipped}</p><hr class="my-4">`;
            }
            document.getElementById("summary-section").innerHTML = summaryContent;
            document.getElementById("question-container").style.display = "none";
            document.getElementById("result-section").style.display = "none";
            document.getElementById("action-buttons").style.display = "none";
            document.getElementById("summary-section").style.display = "block";
        }

        document.getElementById("show-answer").addEventListener("click", showAnswer);
        document.querySelectorAll('input[name="result"]').forEach(radio => {
            radio.addEventListener("change", updateResult);
        });

        document.getElementById("next-question").addEventListener("click", () => {
            console.log("Next Question clicked");
            document.getElementById("result-feedback").textContent = "";
            document.getElementById("result-section").style.display = "none";
            document.querySelector('input[name="result"]:checked').checked = false;
            document.getElementById("next-question").style.display = "none";
            document.getElementById("end-session-action").disabled = true;
            document.getElementById("action-buttons").style.display = "none";
            document.getElementById("show-answer").style.display = "inline-block";
            document.getElementById("end-session").style.display = "inline-block";
            document.getElementById("question-container").style.display = "block";
            document.getElementById("summary-section").style.display = "none";
            displayQuestion();
        });

        document.getElementById("end-session").addEventListener("click", () => {
            console.log("End Session clicked (initial)");
            alert("Please mark a result to end the session.");
        });

        document.getElementById("end-session-action").addEventListener("click", () => {
            console.log("End Session clicked (action)");
            showSummary();
        });

        // Start with the first question
        displayQuestion();
    });
</script>
</body>
</html>
